import { strictEqual, deepStrictEqual } from 'assert'

import { createFinder } from '../src'
describe('expect applied 0.24.0 patch buff/nerf stats', () => {
  const finder = createFinder()
  finder.setLang('ja')

  it('0.24.0を返すべき', () => {
    strictEqual(finder.patch, '0.24.0')
  })
  it('weapons', () => {
    strictEqual(finder.findByLocaled('ワルサーPPK').getStats().attack, 14)
    strictEqual(finder.findByLocaled('ワルサーPPK').getStats().movementSpeed, undefined)
    strictEqual(finder.findByLocaled('亀骨手袋').getStats().movementSpeed, -0.05)
    strictEqual(finder.findByLocaled('如来手闘').getStats().attack, 37)
    strictEqual(finder.findByLocaled('B・ガントレット').getStats().attack, 53)
    strictEqual(finder.findByLocaled('聖なる拳').getStats().attack, 50)
    strictEqual(finder.findByLocaled('天国への階段').getStats().attack, 61)
    strictEqual(finder.findByLocaled('ワンダフルトゥナイト').getStats().attackSpeed, 25)
    strictEqual(finder.findByLocaled('ザ・ウォール').getStats().attack, 75)
    strictEqual(finder.findByLocaled('ザ・ウォール').getStats().attackSpeed, 20)
    strictEqual(finder.findByLocaled('ティーンスピリット').getStats().attackSpeed, 30)
    strictEqual(finder.findByLocaled('カルンウェナン').getStats().attack, 41)
    strictEqual(finder.findByLocaled('カルンウェナン').getStats().skillCooldown, 12)
    strictEqual(finder.findByLocaled('ビームアックス').getStats().movementSpeed, undefined)
    strictEqual(finder.findByLocaled('デュランダルmk2').getStats().attack, 55)
    strictEqual(finder.findByLocaled('スパイの傘').getStats().skillDamage, 28)
    strictEqual(finder.findByLocaled('打狗棒').getStats().attack, 85)
    strictEqual(finder.findByLocaled('双刀').getStats().attack, 18)
    strictEqual(finder.findByLocaled('フィレンツェ式双剣').getStats().attack, 28)
    strictEqual(finder.findByLocaled('ディオスクロイ').getStats().attack, 43)
    strictEqual(finder.findByLocaled('二天一流').getStats().attack, 49)
    strictEqual(finder.findByLocaled('雌雄一対の剣').getStats().attack, 60)
    strictEqual(finder.findByLocaled('ロイガーツァール').getStats().attack, 38)
    strictEqual(finder.findByLocaled('鎖').getStats().attack, 13)
    strictEqual(finder.findByLocaled('双節棍').getStats().attack, 29)
    strictEqual(finder.findByLocaled('シャーパー').getStats().attack, 29)
    strictEqual(finder.findByLocaled('大小盤龍棍').getStats().skillDamage, 17)
    strictEqual(finder.findByLocaled('狂気王のカード').getStats().attackSpeed, 40)
    strictEqual(finder.findByLocaled('風魔手裏剣').getStats().attack, 52)
    strictEqual(finder.findByLocaled('タンキエム').getStats().movementSpeed, undefined)
    strictEqual(finder.findByLocaled('物干し竿').getStats().lifeSteal, 21)
    strictEqual(finder.findByLocaled('ホヴズ').getStats().attack, 50)
    strictEqual(finder.findByLocaled('ダインスレイヴ').getStats().lifeSteal, 25)
    strictEqual(finder.findByLocaled('インターベンション').getStats().attack, 120)
    strictEqual(finder.findByLocaled('NTW-20').getStats().attack, 100)
    strictEqual(finder.findByLocaled('斜射星光').getStats().attack, 100)
    strictEqual(finder.findByLocaled('青龍偃月刀').getStats().attack, 110)
    strictEqual(finder.findByLocaled('青龍偃月刀').getStats().hp, 300)
    strictEqual(finder.findByLocaled('トリアイナ').getStats().attack, 90)
    strictEqual(finder.findByLocaled('トリアイナ').getStats().skillDamage, 17)
    strictEqual(finder.findByLocaled('プラズマ鞭').getStats().attack, 60)
    strictEqual(finder.findByLocaled('ダビデのスリング').getStats().attackExtraDamage, 27)
    strictEqual(finder.findByLocaled('焼夷弾').getStats().attack, 75)
    strictEqual(finder.findByLocaled('エレメンタルボウ').getStats().skillDamage, 38)
    strictEqual(finder.findByLocaled('黄昏の鎧').getStats().hp, 360)
    strictEqual(finder.findByLocaled('シャージャハーン鞘').getStats().hp, 260)
    strictEqual(finder.findByLocaled('騎士の信条').getStats().criticalDamage, 25)
    strictEqual(finder.findByLocaled('マベリックランナー').getStats().movementSpeed, 0.2)
    strictEqual(finder.findByLocaled('マベリックランナー').getStats().movementSpeedNotCombat, 0.55)
    strictEqual(finder.findByLocaled('羽').getStats().movementSpeed, 0.06)
    strictEqual(finder.findByLocaled('狙撃スコープ').getStats().visionRange, 4.5)
    strictEqual(finder.findByLocaled('狙撃スコープ').getStats().attack, 10)
    strictEqual(finder.findByLocaled('ライター').stackable, 2)
    strictEqual(finder.findByLocaled('紅のブレスレット').children.join(','), 'bracelet,spiked plank')
    strictEqual(finder.findByLocaled('アイギス').children.join(','), 'crimson bracelet,leather shield')
    deepStrictEqual(finder.findByLocaled('アイギス').getStats(), { hp: 350, sp: 250, attack: 10, defense: 10 })

    strictEqual(finder.getAreaCount(finder.____('浜辺'), finder.____('投げ罠')), 3)
    strictEqual(finder.getAreaCount(finder.____('浜辺'), finder.____('ネズミ捕り')), 5)
    strictEqual(finder.getAreaCount(finder.____('洋弓場'), finder.____('竹')), 5)
    strictEqual(finder.getAreaCount(finder.____('洋弓場'), finder.____('紙')), 6)
    strictEqual(finder.getAreaCount(finder.____('教会'), finder.____('投げ罠')), 4)
    strictEqual(finder.getAreaCount(finder.____('教会'), finder.____('紙')), 7)

    strictEqual(finder.findByLocaled('ソードストッパー').getStats().defenseCriticalDamage, 10)
    strictEqual(finder.findByLocaled('帽子').getStats().defenseCriticalDamage, 2)
    strictEqual(finder.findByLocaled('安全帽').getStats().defenseCriticalDamage, 4)
    strictEqual(finder.findByLocaled('ティアラ').getStats().defenseCriticalDamage, 7)
    strictEqual(finder.findByLocaled('戦術OPSヘルメット').getStats().defenseCriticalDamage, 10)
  })

  describe.skip('defenseCriticalDamage列を追加', () => {
    it('', () => {
      // Item.getStatsKeys().indexOf('defenseSkill') + 1
      const defenseCriticalDamageIndex = 18

      const items = finder.getItemArray().map((item) => {
        const keys = ['id', 'type', 'rarity', 'stackable', 'quantity', 'parents', 'children', 'src', 'stats']
        const statsIndex = keys.indexOf('stats')
        const statsValues = item[statsIndex]
        statsValues.splice(defenseCriticalDamageIndex, 0, 0)
        return item
      })
      require('fs').writeFileSync('0.24.0.dictItemsWithDefenseCriticalDamage.json', JSON.stringify(items))
    })
    it('', () => {
      finder.patchStats('ソードストッパー', 'defenseCriticalDamage', 10)
      require('fs').writeFileSync('0.24.0.dictItems.json', JSON.stringify(finder.getItemArray()))
    })
  })

  describe.skip('src/dict更新用 パッチ実行時だけ実行する', () => {
    it('アイテム', () => {
      finder.patchStats('ワルサーPPK', 'attack', 14)
      finder.patchStats('ワルサーPPK', 'movementSpeed', 0)
      finder.patchStats('亀骨手袋', 'movementSpeed', -0.05)
      finder.patchStats('如来手闘', 'attack', 37)
      finder.patchStats('B・ガントレット', 'attack', 53)
      finder.patchStats('聖なる拳', 'attack', 50)
      finder.patchStats('天国への階段', 'attack', 61)
      finder.patchStats('ワンダフルトゥナイト', 'attackSpeed', 25)
      finder.patchStats('ザ・ウォール', 'attack', 75)
      finder.patchStats('ザ・ウォール', 'attackSpeed', 20)
      finder.patchStats('ティーンスピリット', 'attackSpeed', 30)
      finder.patchStats('カルンウェナン', 'attack', 41)
      finder.patchStats('カルンウェナン', 'skillCooldown', 12)
      finder.patchStats('ビームアックス', 'movementSpeed', 0)
      finder.patchStats('デュランダルmk2', 'attack', 55)
      finder.patchStats('スパイの傘', 'skillDamage', 28)
      finder.patchStats('打狗棒', 'attack', 85)
      finder.patchStats('双刀', 'attack', 18)
      finder.patchStats('フィレンツェ式双剣', 'attack', 28)
      finder.patchStats('ディオスクロイ', 'attack', 43)
      finder.patchStats('二天一流', 'attack', 49)
      finder.patchStats('雌雄一対の剣', 'attack', 60)
      finder.patchStats('ロイガーツァール', 'attack', 38)
      finder.patchStats('鎖', 'attack', 13)
      finder.patchStats('双節棍', 'attack', 29)
      finder.patchStats('シャーパー', 'attack', 29)
      finder.patchStats('大小盤龍棍', 'skillDamage', 17)
      finder.patchStats('狂気王のカード', 'attackSpeed', 40)
      finder.patchStats('風魔手裏剣', 'attack', 52)
      finder.patchStats('タンキエム', 'movementSpeed', 0)
      finder.patchStats('物干し竿', 'lifeSteal', 21)
      finder.patchStats('ホヴズ', 'attack', 50)
      finder.patchStats('ダインスレイヴ', 'lifeSteal', 25)
      finder.patchStats('インターベンション', 'attack', 120)
      finder.patchStats('NTW-20', 'attack', 100)
      finder.patchStats('斜射星光', 'attack', 100)
      finder.patchStats('青龍偃月刀', 'attack', 110)
      finder.patchStats('青龍偃月刀', 'hp', 300)
      finder.patchStats('トリアイナ', 'attack', 90)
      finder.patchStats('トリアイナ', 'skillDamage', 17)
      finder.patchStats('プラズマ鞭', 'attack', 60)
      finder.patchStats('ダビデのスリング', 'attackExtraDamage', 27)
      finder.patchStats('焼夷弾', 'attack', 75)
      finder.patchStats('エレメンタルボウ', 'skillDamage', 38)
      finder.patchStats('黄昏の鎧', 'hp', 360)
      finder.patchStats('シャージャハーン鞘', 'hp', 260)
      finder.patchStats('騎士の信条', 'criticalDamage', 25)
      finder.patchStats('マベリックランナー', 'movementSpeed', 0.2)
      finder.patchStats('マベリックランナー', 'movementSpeedNotCombat', 0.55)
      finder.patchStats('羽', 'movementSpeed', 0.06)
      finder.patchStats('狙撃スコープ', 'visionRange', 4.5)
      finder.patchStats('狙撃スコープ', 'attack', 10)

      require('fs').writeFileSync('0.24.0.dictItems.json', JSON.stringify(finder.getItemArray()))
    })
    it('エリア個数', () => {
      finder.patchAreaCount('浜辺', '投げ罠', 3)
      finder.patchAreaCount('浜辺', 'ネズミ捕り', 5)
      finder.patchAreaCount('洋弓場', '竹', 5)
      finder.patchAreaCount('洋弓場', '紙', 6)
      finder.patchAreaCount('教会', '投げ罠', 4)
      finder.patchAreaCount('教会', '紙', 7)

      require('fs').writeFileSync('0.24.0.dictArea.json', JSON.stringify(finder.getAreaArray()))
    })
  })
})
